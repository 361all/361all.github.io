<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=0.5">
    <title>四季</title>
    <style>
body{
	background:#069;
}

.loading {width:200px;height:200px;top:200px;position:relative;margin:50px auto;border:1px solid #f90;border-radius:50%;}
.info{line-height:200px;text-align:center;top:-50px;font-size:30px;color:#fff;}
.dot {width:100%;;height:100%;animation:rond .8s infinite;-webkit-animation:rond 3s infinite;}
.dot:after {width:10px;height:10px;position:absolute;top:-5px;left:90px;content:"";display:table;background-color:#f50;border-radius:50%;}
.num {width:100%;height:100%;position:absolute;top:80px;left:0;text-align:center;font-size:20px;color:#fff;}
@keyframes rond {
	0% {transform:rotate(0deg);}
	100% {transform:rotate(360deg);}
}
@-webkit-keyframes rond {
	0% {-webkit-transform:rotate(0deg);}
	100% {-webkit-transform:rotate(360deg);}
} 

#main{	
	position: relative;
	width: 184px;
    height: 242px;
	left:35%;
	margin-left:-200px;
	top:250px;
    transform-style: preserve-3d;
	display:none;
}

#pic{
	width: 368px;
    height: 484px;
	position: absolute;
	top:15%;
	left:55%;
	border:1px solid #fff;
	-webkit-transform:rotateZ(0deg);
	background-size:100% 100%; 
	display:none;
}

#main>div{
    position: absolute;
}

.side{
	width: 184px;
    height: 242px;
}

.ye{
	width: 240px;
    height: 600px;
	top:-179px;
}

.ye1{
	width: 240px;
    height: 500px;
	top:-129px;
}

.hua{
	width: 106px;
    height: 140px;
	top:51px;
}

.deng{
	width: 240px;
    height: 430px;
	top:-99px;
}

.bottom{
	width: 368px;
    height: 323px;
    left:0px;
	top:-39px;
    transform: rotateY(270deg) rotateZ(90deg) translateZ(214px);
	-webkit-transform:rotateY(270deg) rotateZ(90deg) translateZ(214px);
}
.up{
	width: 368px;
    height: 323px;
    left:0px;
	top:-39px;
    transform: rotateY(90deg) rotateZ(90deg) translateZ(29px);
	-webkit-transform:rotateY(90deg) rotateZ(90deg) translateZ(29px);
}


@media screen and (max-device-width:640px){

#main{	
	position: absolute;
	left:50%;
	top:180px;
	margin-left:-90px;

}
	
#pic{
	position: relative;
	left:50%;
	top:600px;
	margin-left:-180px;
}

}

	</style>
</head>
<body>
<div id="loading" class="loading">	
	<div class="dot"></div>
	<div class="num" id="num">加载中<br>0%</div>
	<div class="info">洛神赋图</div>
</div>
<div id="main">
	
	<div id="sb1" class="side"></div>
    <div id="sb2" class="side"></div>
    <div id="sb3" class="side"></div>
    <div id="sb4" class="side"></div>
    <div id="sb5" class="side"></div>
    <div id="sb6" class="side"></div>
	<div id="sb7" class="up"></div>
    <div id="sb8" class="bottom"></div>  
  	
	<div id="s1" class="side"></div>
    <div id="s2" class="side"></div>
    <div id="s3" class="side"></div>
    <div id="s4" class="side"></div>
    <div id="s5" class="side"></div>
    <div id="s6" class="side"></div>
	<div id="s7" class="up"></div>
    <div id="s8" class="bottom"></div>
	
	<div id="sf1" class="side"></div>
    <div id="sf2" class="side"></div>
    <div id="sf3" class="side"></div>
    <div id="sf4" class="side"></div>
    <div id="sf5" class="side"></div>
    <div id="sf6" class="side"></div>
	<div id="sf7" class="up"></div>
    <div id="sf8" class="bottom"></div>  
	
	<div id="y1" class="ye"></div>
    <div id="y2" class="ye"></div>
    <div id="y3" class="ye"></div>
    <div id="y4" class="ye"></div>
    <div id="y5" class="ye"></div>
    <div id="y6" class="ye"></div>
	
	<div id="y11" class="ye1"></div>
    <div id="y12" class="ye1"></div>
    <div id="y13" class="ye1"></div>
    <div id="y14" class="ye1"></div>
    <div id="y15" class="ye1"></div>
    <div id="y16" class="ye1"></div>
	
	<div id="h1" class="hua"></div>
    <div id="h2" class="hua"></div>
    <div id="h3" class="hua"></div>
    <div id="h4" class="hua"></div>
    <div id="h5" class="hua"></div>
    <div id="h6" class="hua"></div>
	
	<div id="d1" class="deng"></div>
    <div id="d2" class="deng"></div>
    <div id="d3" class="deng"></div>
    <div id="d4" class="deng"></div>
    <div id="d5" class="deng"></div>
    <div id="d6" class="deng"></div>

</div>
<div id="pic"></div>
</body>
<script>

	function mod(a,b)
	{	
		if(a>0) return a%b;
		if(a%b) return b-((-a)%b);
		return 0;
	}
	function getOpacity(m,s)
	{
		if(s==null)s=1;
		m=2*Math.abs(m-0.5);
		m=1-m;m=m*s;		
		if(m<0) return 0;
		if(m>1) return 1;
		return m;		
	}
	
	function getOpacity2(m,s)
	{
		if(s==null)s=1;
		m=m*s;	
		m-=(s-1)*0.5;
		if(m<0) return 0;
		if(m>1) return 1;
		return m;		
	}
	
	function getOpacity3(m,a,b)
	{
		m=2*Math.abs(m-0.5);
		m=a+m*(b-a);
		if(m<0) return 0;
		if(m>1) return 1;
		return m;		
	}
	
	var oMain=document.getElementById('main');
	var oPic=document.getElementById('pic');
	var picn=new Array("s1.jpg","s2.jpg","s3.jpg","s4.jpg","s5.jpg","s6.jpg","up.png","bottom.png"); 
	var piccn=new Array("cs1.png","cs2.png","cs3.png","cs4.png","cs5.png","cs6.png","cup.png","cbottom.png"); 
	var imgn=new Array("1","2","a","3","4","b"); 
	
	function move(a,b)
	{

		var x=parseFloat (oMain.style['-webkit-transform'].split('rotateX(')[1].split('deg')[0])+(-b);
		if(x<-20) x=-20;if(x>20) x=20;
		var y=parseFloat (oMain.style['-webkit-transform'].split('rotateY(')[1].split('deg')[0])+(a);
		//y=0;
		var z=parseFloat (oMain.style['-webkit-transform'].split('rotateZ(')[1].split('deg')[0])+(a);
		z=-90;
		oMain.style['transform']=oMain.style['-webkit-transform'] ="rotateX("+x+"deg) rotateY("+y+"deg) rotateZ("+z+"deg)";
		
		
		var cycle=360*4;
		dOpc=getOpacity3(1-(mod(y+720,cycle)/cycle),2.5,-2.8);
		sOpc=getOpacity2(1-(mod(y,60)/60),1.5);
		yOpc=getOpacity3(1-(mod(y,cycle)/cycle),0.8,-2.4);
		hOpc=getOpacity3(1-(mod(y,cycle)/cycle),0.9,-4);
		y1Opc=getOpacity3(1-(mod(y,cycle)/cycle),0.8,-1.4);
		if(dOpc==0) sbOpc=1;
		else {
			sbOpc=1-dOpc;
			if(sOpc>sbOpc) sOpc=sbOpc;					
		};
		
		
		//oPic.innerHTML=mod(Math.floor((y+30)/60),6);
		if(dOpc==0) oPic.style.backgroundImage="url('img/"+imgn[mod(Math.floor((y-30)/60),6)]+"s"+(mod(Math.floor((y+30)/60),6)+1)+".jpg')";
		else oPic.style.backgroundImage="url('img/cs"+(mod(Math.floor((y+30)/60),6)+1)+".png')";
		oPic.style.opacity = getOpacity(mod(y+30,60)/60,1.5);
		
		
	
		for(var i=1;i<=8;i++)
		{
			document.getElementById('sf'+i).style.backgroundImage="url('img/"+piccn[i-1]+"')";
			document.getElementById('sf'+i).style.opacity=dOpc;
					
			document.getElementById('s'+i).style.backgroundImage="url('img/"+imgn[mod(Math.floor((y-60)/60),6)]+picn[i-1]+"')";
			document.getElementById('sb'+i).style.backgroundImage="url('img/"+imgn[mod(Math.floor((y)/60),6)]+picn[i-1]+"')";
			
			document.getElementById('s'+i).style.opacity= sOpc;
			document.getElementById('sb'+i).style.opacity= sbOpc;
			
		}
		
		for(var i=1;i<=6;i++)
		{
			//document.getElementById('y'+i).style.backgroundImage="url('img/"+imgn[mod(Math.floor((y)/60),6)]+picn[i-1]+"')";
			document.getElementById('y'+i).style.opacity= yOpc;
			document.getElementById('h'+i).style.opacity= hOpc;
			document.getElementById('y1'+i).style.opacity= y1Opc;
			document.getElementById('d'+i).style.opacity= dOpc
			//console.log(document.getElementById('d'+i).style.opacity);
		
		}
	};
	
	
	
    window.onload=function (){
	
	/* preload */
	var newimages=[];
	function preloadimages(arr){
		
		var arr=(typeof arr!="object")? [arr] : arr  ;
		for (var i=0; i<arr.length; i++){
			newimages[i]=new Image();
			newimages[i].src="img/"+arr[i];			
		}
	}		
	preloadimages([
	"1s1.jpg","1s2.jpg","1s3.jpg","1s4.jpg","1s5.jpg","1s6.jpg","1up.png","1bottom.png",
	"2s1.jpg","2s2.jpg","2s3.jpg","2s4.jpg","2s5.jpg","2s6.jpg","2up.png","2bottom.png",
	"3s1.jpg","3s2.jpg","3s3.jpg","3s4.jpg","3s5.jpg","3s6.jpg","3up.png","3bottom.png",
	"4s1.jpg","4s2.jpg","4s3.jpg","4s4.jpg","4s5.jpg","4s6.jpg","4up.png","4bottom.png",
	"as1.jpg","as2.jpg","as3.jpg","as4.jpg","as5.jpg","as6.jpg","aup.png","abottom.png",
	"bs1.jpg","bs2.jpg","bs3.jpg","bs4.jpg","bs5.jpg","bs6.jpg","bup.png","bbottom.png",
	"cs1.png","cs2.png","cs3.png","cs4.png","cs5.png","cs6.png","cup.png","cbottom.png",
	"deng.png","ye.png","ye1.png","hua.png"]);
	
	var ready=0;
	var imgLoad=setInterval(function(){ 
		if(ready==newimages.length) 
		{
			clearInterval(imgLoad);
			document.getElementById('loading').style.display="none";
			document.getElementById('main').style.display="block";
			document.getElementById('pic').style.display="block";
			return;
		}	
		ready=0;
		for (var i=0; i<newimages.length; i++) if(newimages[i].height)ready++;
		document.getElementById('num').innerHTML="加载中<br>"+parseInt(100*ready/newimages.length)+"%";		
	}, 100);
	
	/* preload end */
	
	
        oMain.style['transform']=oMain.style['-webkit-transform'] ="rotateX(-20deg) rotateY(0deg) rotateZ(270deg)";
		for(var i=1;i<=6;i++)
		{
			document.getElementById('sf'+i).style['transform']=
			document.getElementById('sf'+i).style['-webkit-transform']=
			document.getElementById('s'+i).style['transform']=
			document.getElementById('s'+i).style['-webkit-transform']=
			document.getElementById('sb'+i).style['transform']=
			document.getElementById('sb'+i).style['-webkit-transform']=
			"rotateX("+(-60+60*i)+"deg) translateZ(159.34px) rotateZ(90deg)";
			
			document.getElementById('y'+i).style['transform']=
			document.getElementById('y'+i).style['-webkit-transform']=
			"rotateX("+(-60+60*i)+"deg) translateZ(283px) rotateZ(90deg) translateY(105px) rotateX(126deg)";	
			document.getElementById('y'+i).style.backgroundImage="url('img/ye.png')";
			
			document.getElementById('y1'+i).style['transform']=
			document.getElementById('y1'+i).style['-webkit-transform']=
			"rotateX("+(-30+60*i)+"deg) translateZ(274px) rotateZ(90deg) translateY(95px) rotateX(122deg)";	
			document.getElementById('y1'+i).style.backgroundImage="url('img/ye1.png')";
			
			document.getElementById('d'+i).style['transform']=
			document.getElementById('d'+i).style['-webkit-transform']=
			"rotateX("+(-30+60*i)+"deg) translateZ(120px) translateX(-75px) rotateX(-90deg) rotateZ(90deg) ";	
			document.getElementById('d'+i).style.backgroundImage="url('img/deng.png')";
			
			document.getElementById('h'+i).style['transform']=
			document.getElementById('h'+i).style['-webkit-transform']=
			"rotateX("+(-30+60*i)+"deg) translateZ(50px) translateX(225px) rotateX(-90deg) rotateZ(90deg) ";	
			document.getElementById('h'+i).style.backgroundImage="url('img/hua.png')";
		}
	
        oMain.onmousedown = function(ev){ return move0(ev,move);};
        oMain.ontouchstart = function(ev){ return move1(ev,move);};
		oMain.onmousewheel = function(ev){ return move2(ev,move); };
        move(360,0);
    }

    function move0(ev,mvfn)
    {
        var ev = ev || window.event;
        var disX = ev.clientX;
        var disY = ev.clientY;

        document.onmousemove = function(ev){
            var ev = ev || window.event;
            mvfn(ev.clientX - disX,ev.clientY - disY);
            disX = ev.clientX;disY = ev.clientY;

        };
        document.onmouseup = function(){
            document.onmousemove = null;
        };
        return false;
    }

    function move1(ev,mvfn)
    {
        var disX = ev.changedTouches[0].clientX;
        var disY = ev.changedTouches[0].clientY;
        document.ontouchmove = function(ev){

            mvfn(ev.changedTouches[0].clientX - disX,ev.changedTouches[0].clientY - disY);
            disX = ev.changedTouches[0].clientX;
            disY = ev.changedTouches[0].clientY;

        };
        document.ontouchend = function(){
            document.ontouchstart = null;
            document.ontouchmove = null;
        };
        return false;
    }
	
	function move2(ev,mvfn)
	{
		var delta = 0;
		if (ev.wheelDelta) {
			delta = ev.wheelDelta/120; 
			if (window.opera) delta = -delta;
		} else if (ev.detail) {
			delta = -ev.detail/3;
		}
		if (delta) mvfn(5*delta,0);
		return false;
	}


</script>
</html>